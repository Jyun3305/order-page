<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>線上點餐</title>
  <script src="mqtt.min.js"></script>
</head>
<body>
  <h2>線上點餐系統</h2>
  <label>桌號:
    <select id="table">
      <option value="1">1號桌</option>
      <option value="2">2號桌</option>
      <option value="3">3號桌</option>
      <option value="4">4號桌</option>
      <option value="5">5號桌</option>
    </select>
  </label>
  <br>
  <label>餐點:
    <select id="food">
      <option value="雞腿飯">雞腿飯</option>
      <option value="排骨飯">排骨飯</option>
      <option value="燒肉飯">燒肉飯</option>
      <option value="滷肉飯">滷肉飯</option>
      <option value="炒飯">炒飯</option>
    </select>
  </label>
  <br>
  <label>數量:
    <select id="qty">
      <option value="1">1份</option>
      <option value="2">2份</option>
      <option value="3">3份</option>
      <option value="4">4份</option>
      <option value="5">5份</option>
    </select>
  </label>
  <br>
  <button onclick="sendOrder()">送出訂單</button>
  <script>
    // 連接到 MQTT broker，帶入唯一 clientId
    const client = mqtt.connect('wss://broker.emqx.io:8084/mqtt', {
      clientId: 'WebOrder-' + Math.random().toString(16).substr(2, 8),
      clean: true
    });

    // Debug: 連線成功/失敗提示
    client.on('connect', function() {
      alert('已連接到 MQTT broker');
      console.log('已連接到 MQTT broker');
    });
    client.on('error', function(err) {
      alert('MQTT 連線錯誤: ' + err);
      console.error('MQTT 連線錯誤:', err);
    });
    client.on('reconnect', function() {
      console.log('正在重新連線到 MQTT broker...');
    });
    client.on('close', function() {
      console.log('MQTT 連線已關閉');
    });

    function sendOrder() {
      const order = {
        table: document.getElementById('table').value,
        food: document.getElementById('food').value,
        quantity: parseInt(document.getElementById('qty').value)
      };
      client.publish('restaurant/orders', JSON.stringify(order));
      alert('訂單已送出！');
    }
  </script>
</body>
</html>
